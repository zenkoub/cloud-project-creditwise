<!DOCTYPE html>

<html lang="th">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<title>Dashboard | Credit Wise</title>
<link href="style.css" rel="stylesheet"/>
<script src="https://www.gstatic.com/charts/loader.js" type="text/javascript"></script>
<script src="curriculum-master.js"></script>
<script src="user.js"></script>
<script type="text/javascript">
      google.charts.load('current', { packages: ['corechart'] });
    
    function drawChart(history) {
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏î Chart: ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠ Google Charts ‡∏û‡∏£‡πâ‡∏≠‡∏°
        if (typeof google === 'undefined' || !google.visualization || !google.visualization.arrayToDataTable) {
             return;
        }
        
        var chartDataArray = [['Term', 'GPAX', 'GPA']]; 
        
        history.forEach(item => {
            // ‡πÉ‡∏ä‡πâ item.gpax (‡∏™‡∏∞‡∏™‡∏°) ‡πÅ‡∏•‡∏∞ item.term_gpa (‡∏£‡∏≤‡∏¢‡πÄ‡∏ó‡∏≠‡∏°)
            chartDataArray.push([item.term, item.gpax, item.term_gpa]); 
        });

        var data = google.visualization.arrayToDataTable(chartDataArray);

        var options = {
            legend: { position: 'bottom' },
            curveType: 'function',
            title: '',
            chartArea: { left: 40, top: 10, width: '85%', height: '70%' },
            colors: ['#1557d5', '#7ba8ff'],
            lineWidth: 3,
            backgroundColor: '#ffffff',
            hAxis: { textStyle: { color: '#1b2b57' } },
            vAxis: {
                minValue: 0,
                maxValue: 4,
                ticks: [0, 1, 2, 3, 4],
                textStyle: { color: '#1b2b57' }
            }
        };

        var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));
        chart.draw(data, options);
    }

   function updateDashboardInfo() {
    const userData = getCurrentUserData();
    const history = userData.academic_history || []; 
    const trackId = userData.info.track_id;
    
    // ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á TRACKS_INFO ‡∏à‡∏≤‡∏Å window
    const trackName = window.TRACKS_INFO && window.TRACKS_INFO[trackId] 
        ? window.TRACKS_INFO[trackId].full_name 
        : 'N/A';

    // ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤
    const badgeEl = document.getElementById('student-badge');
    if (badgeEl) {
        badgeEl.textContent = `${userData.info.name || 'N/A'} ‚Ä¢ ${userData.info.id || 'N/A'}`;
    }

    // ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Track
    const trackEl = document.getElementById('student-track');
    if (trackEl) {
        trackEl.textContent = `Track: ${TRACKS_INFO[trackId].full_name}`;
    }

    // ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï GPAX ‡πÅ‡∏•‡∏∞ GPA ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    const latest = history.length > 0 
        ? history[history.length - 1] 
        : { gpax: 0.00, term_gpa: 0.00 };
    
    document.querySelector('.dash-card.big:nth-child(1) .dash-value').textContent = 
        latest.gpax.toFixed(2); 
    document.querySelector('.dash-card.big:nth-child(2) .dash-value').textContent = 
        latest.term_gpa.toFixed(2); 

    // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏Å‡∏£‡∏î
    const gradeListDiv = document.querySelector('.dash-card.grade-list .grades');
    gradeListDiv.innerHTML = '';
    [...history].reverse().forEach(item => { 
        gradeListDiv.innerHTML += `
            <div><span>${item.term}</span><b>${item.term_gpa.toFixed(2)}</b></div>
        `;
    });

    // ‚úÖ ‡∏ß‡∏≤‡∏î Chart
    google.charts.setOnLoadCallback(() => drawChart(history));
}

    // Responsive resize
    window.addEventListener('resize', () => {
         const userData = window.getCurrentUserData ? window.getCurrentUserData() : { academic_history: [] };
         drawChart(userData.academic_history || []);
    });

    // üöÄ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠ DOM ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à (‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏î Chart ‡∏ú‡πà‡∏≤‡∏ô Callback)
    document.addEventListener('DOMContentLoaded', updateDashboardInfo);
    </script>
</head>
<body class="bg">
<div class="layout">
<aside class="sidebar" id="sidebar">
<div class="side-title"><div class="hat"></div><div>Credit¬†Wise</div></div>
<a class="side-btn active" href="dashboard.html">Dashboard</a>
<a class="side-btn" href="curriculum.html">Curriculum Plan</a>
<a class="side-btn" href="grade-entry.html">Grade Entry</a>
<a class="side-btn" href="planner.html">Planner</a>
<a class="side-btn" href="index.html">Sign Out</a>

<a class="side-btn-bottom" href="index.html">Sign out</a></aside>
<main><div class="mobile-topbar"><button aria-label="Toggle menu" class="hamburger" id="menuBtn">‚ò∞</button></div>
<div class="page-head" style="margin-top: 5%;">
<i></i>
<div class="badge" id="student-badge"></div>
</div>
<div class="page-head">
<h2 style="margin:0;color:#fff; text-shadow: 2px 2px 3px #182747;">Dashboard</h2>
<div id="student-track" style="color: #040431;"></div>
</div>
<div class="panel">
<h3>Welcome to Credit Wise üéì</h3>
<p>‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏ô‡∏π‡∏ã‡πâ‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤: <b>Curriculum Plan</b>, <b>Grade Entry</b>, ‡πÅ‡∏•‡∏∞ <b>Planner</b>.</p>
<p>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ñ‡∏π‡∏Å‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å JavaScript ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô Static ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏≥‡∏Ç‡∏∂‡πâ‡∏ô AWS.</p>
</div>
<div class="dash-grid">
<div class="dash-card big">
<div class="dash-title">GPAX</div>
<div class="dash-value">‚Äî</div>
</div>
<div class="dash-card big">
<div class="dash-title">GPA</div>
<div class="dash-value">‚Äî</div>
</div>
<div class="dash-card wide">
<div id="curve_chart" style="width:100%;height:300px;"></div>
</div>
<div class="dash-card grade-list">
<div class="dash-title">History</div>
<div class="grades">
</div>
</div>
</div>
</main>
</div>
<script src="menu-toggle.js"></script></body>
</html>     
