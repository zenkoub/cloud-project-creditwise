<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin • Curriculum Management | Credit Wise</title>
  <link href="css/style.css" rel="stylesheet" />
</head>

<body class="bg admin-page">

  <script>
    (function () {
      const userRole = localStorage.getItem('cw_role');
      // Also check for userId just in case role exists without user somehow
      const userId = localStorage.getItem('cw_user');
      if (!userId || userRole !== 'admin') {
        alert('Access Denied: Admin access required.');
        window.location.href = 'index.html';
      }
    })();
  </script>

  <div class="layout">
    <aside class="sidebar" id="sidebar">
      <div class="side-title">
        <div class="hat"></div> <div>Credit Wise 🎓</div>
        <button class="hamburger side-close" id="closeMenu" aria-label="Close menu">✕</button>
      </div>
      <nav>
        <a class="side-btn active" href="admin-curriculum.html">📚 Curriculum Management</a>
        <a class="side-btn" href="admin-students.html">🧑‍🎓 Student Management</a>
        <a class="side-btn side-btn-bottom" href="index.html">🚪 Sign out</a>
      </nav>
    </aside>

    <main>
      <div class="mobile-topbar">
        <button class="hamburger" id="menuBtn" aria-label="Toggle menu">☰</button>
      </div>

      <header class="page-head">
        <h2>Curriculum Management</h2>
        <div> <span class="badge">Admin Panel</span>
      <span id="admin-name" class="admin-name-display"></span> </div>
      </header>

      <section class="toolbar" style="justify-content: flex-end; background: none; border: none; padding: 0 0 16px 0;">
          <button class="btn-sm btn-add" id="btnAddCourse">➕ Add Course</button>
          <button class="btn-sm btn-edit" id="btnEditCourse">✏️ Edit Selected</button>
          <button class="btn-sm btn-del" id="btnDeleteCourse">🗑️ Delete Selected</button>
      </section>

      <section class="search-bar-container">
        <select id="filterTrack" aria-label="Filter by Track">
          <option value="">All Tracks</option>
          <option value="CORE">Core Courses</option>
          <option value="SD">Software Dev</option>
          <option value="ITI">IT Infra</option>
          <option value="MM">Multimedia</option>
          </select>
        <select id="filterYear" aria-label="Filter by Year">
          <option value="">All Years</option>
          <option value="1">Year 1</option>
          <option value="2">Year 2</option>
          <option value="3">Year 3</option>
          <option value="4">Year 4</option>
        </select>
         <select id="filterSemester" aria-label="Filter by Semester">
          <option value="">All Semesters</option>
          <option value="1">Semester 1</option>
          <option value="2">Semester 2</option>
          <option value="0">Summer</option> </select>
        <input type="text" id="searchBox" class="search" placeholder="Search by Code or Name..." aria-label="Search Courses">
        <button id="btnSearch" class="search-btn">Search</button>
      </section>

      <section class="card">
        <div id="courseGroupContainer">
           <p class="text-center muted">Loading courses...</p>
           </div>
      </section>

    </main>
  </div>

  <dialog id="courseEditModal">
    <div class="modal">
      <header class="modal-h" id="modalTitle">Add/Edit Course</header>
      <section class="modal-b">
        <form id="courseForm">
          <input name="course_id" type="hidden" value=""> <div class="grid" style="grid-template-columns: 100px 100px 1fr 1fr;"> <label for="courseYear">Year</label>
             <label for="courseSemester">Semester</label>
             <label for="courseCode">Course Code</label>
             <label for="courseName">Course Name</label>

             <input class="ip" type="number" name="year" id="courseYear" placeholder="e.g., 1" min="1" max="8" required />
             <input class="ip" type="number" name="semester" id="courseSemester" placeholder="e.g., 1, 2, 0(S)" min="0" max="2" required /> <input class="ip" name="code" id="courseCode" placeholder="e.g., 0601xxxx" required />
             <input class="ip" name="name" id="courseName" placeholder="e.g., Intro to IT" required />

             <label for="courseCredit">Credit</label>
             <label for="courseType">Type</label>
             <label for="courseTrack">Track</label>
             <label for="courseFormat">Format (Opt.)</label>

             <input class="ip" type="number" name="credit" id="courseCredit" placeholder="e.g., 3" min="0" step="1" required />
             <select name="type" id="courseType" class="ip">
                <option value="Core">Core</option>
                <option value="Major">Major</option>
                <option value="Gen">General Ed</option>
                <option value="IT_Elective">IT Elective</option>
                <option value="Gen_Elective">Gen Ed Elective</option>
                <option value="Free_Elective">Free Elective</option>
                <option value="Coop">Co-op</option>
             </select>
             <select name="track" id="courseTrack" class="ip">
                 <option value="CORE">CORE (Required for All)</option>
                 </select>
             <input class="ip" name="credit_format" id="courseFormat" placeholder="e.g., 3(2-2-5)">

          </div>
          <footer class="right">
            <button class="btn-sm btn-add" type="submit">💾 Save</button>
            <button class="btn-sm btn-del" id="closeModalBtn" type="button">❌ Cancel</button>
          </footer>
        </form>
      </section>
    </div>
  </dialog>

  <script src="js/curriculum-master.js"></script>
  
  <script src="js/user.js"></script>

  <script src="js/admin.js"></script>

  <script src="js/admin-curriculum.js"></script>

  <script src="js/menu-toggle.js"></script>
 </body>
</html>